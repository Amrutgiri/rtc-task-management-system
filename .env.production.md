# Production Environment Variables

## Backend (Render)

Add these environment variables in your Render dashboard:

### Database
```
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/tms?retryWrites=true&w=majority
```

### Authentication
```
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRE=7d
```

### Server
```
NODE_ENV=production
PORT=3232
```

### Frontend URL (IMPORTANT for Socket.io)
```
FRONTEND_ORIGIN=https://your-frontend-app.vercel.app
```

### Email (Optional)
```
EMAIL_SERVICE=gmail
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
```

---

## Frontend (Vercel)

Add these environment variables in your Vercel project settings:

### Backend API URL
```
VITE_API_URL=https://your-backend-app.onrender.com/api
```

**IMPORTANT:** Replace `your-backend-app` with your actual Render app name!

---

## How to Set Environment Variables:

### Render:
1. Go to your Render dashboard
2. Select your backend service
3. Go to "Environment" tab
4. Click "Add Environment Variable"
5. Add each variable one by one
6. Click "Save Changes"
7. **Manual Deploy** to apply changes

### Vercel:
1. Go to your Vercel project
2. Go to "Settings" → "Environment Variables"
3. Add each variable
4. Select environment: **Production**
5. Click "Save"
6. Redeploy your frontend

---

## Socket.io Configuration

### What We Fixed:

1. **Frontend:** Updated `NotificationContext.tsx` to use `VITE_API_URL` instead of `localhost:3232`
2. **Backend:** Updated `socket.js` CORS to allow your Vercel frontend origin
3. **Added connection error handling** for debugging

### Socket Connection Flow:

```
Frontend (Vercel)
    ↓
VITE_API_URL (environment variable)
    ↓
https://your-backend.onrender.com
    ↓
Socket.io Server (with CORS enabled)
    ↓
✅ Connected!
```

---

## Testing Socket.io Connection

1. **Deploy both apps**
2. **Open browser console** on your Vercel frontend
3. **Look for these messages:**
   - ✅ `Socket connected successfully` - Good!
   - ❌ `Socket connection error` - Check CORS/URL

4. **Test real-time notifications:**
   - Assign a task
   - Should see notification immediately

---

## Common Issues:

### Issue: "Socket connection error: CORS"
**Solution:**
- Make sure `FRONTEND_ORIGIN` in Render matches your Vercel URL
- Include `https://` in the URL
- Redeploy backend after changing env vars

### Issue: "Transport unknown"
**Solution:**
- Backend now supports both `websocket` and `polling`
- Should auto-fallback if websocket fails

### Issue: "Socket timeout"
**Solution:**
- Check if backend is awake (Render free tier sleeps after inactivity)
- Visit backend URL to wake it up

---

## Verification Checklist:

### Backend (Render):
- [ ] `FRONTEND_ORIGIN` set to Vercel URL
- [ ] `MONGO_URI` configured
- [ ] `JWT_SECRET` set
- [ ] Service deployed and running

### Frontend (Vercel):
- [ ] `VITE_API_URL` set to Render backend URL
- [ ] Build successful
- [ ] Deployment complete

### Socket.io:
- [ ] Browser console shows "Socket connected successfully"
- [ ] No CORS errors
- [ ] Real-time notifications working

---

## Quick Test:

1. Open your Vercel app
2. Press F12 (open console)
3. Login
4. Look for: `Socket connected successfully`
5. Assign yourself a task from another browser/incognito
6. Should see notification pop up!

---

**Everything configured!** Push the changes and redeploy both backend and frontend.
